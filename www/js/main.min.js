"use strict";!function(){var t=function(){var t=this;t.getOptions=function(){t.container=document.querySelector(".shopList"),t.content=document.querySelector(".shopListMain__content"),t.template=document.querySelector("#shopListItem").innerHTML,t.openFooterBtn=document.querySelector(".shopListMain__open"),t.footer=document.querySelector(".shopListFooter"),t.input=document.querySelector(".shopListFooter__input"),t.form=document.querySelector(".shopListFooter__form"),t.submitBtn=document.querySelector(".shopListFooter__btn.shopListFooter__btn_type_submit"),t.shopList=[]},t.loadData=function(){var e=localStorage.getItem("shopList");e&&(t.shopList=JSON.parse(e))},t.setupListener=function(){t.openFooterBtn.addEventListener("click",t.openFooter),t.footer.addEventListener("click",t.closeFooter),t.input.addEventListener("keyup",t.handleKeyUp),t.form.addEventListener("submit",t.submit),t.submitBtn.addEventListener("click",t.handleFocus),t.container.addEventListener("click",t.routeClick)},t.routeClick=function(e){var n=e.target,o="";n.classList.contains("shopListItem__content")?o="toggleItemPanel":n.classList.contains("shopListItem__btn_type_complete")&&(o="complete"),o&&t[o](e)},t.toggleItemPanel=function(e){var n=e.target;if(n.classList.contains("shopListItem__content")){var o=n.getAttribute("data-id");o&&(t.shopList=t.shopList.map(function(t){return t.id==o&&(t.isOpen=!t.isOpen),t}),t.render())}},t.complete=function(e){var n=e.target,o=n.getAttribute("data-id");o&&(t.shopList=t.shopList.filter(function(t){return t.id!=o}),t.render(),t.updateLocalStorage())},t.openFooter=function(e){e.preventDefault(),t.container.classList.add("shopList_state_add"),t.input.focus()},t.closeFooter=function(e){e.target===t.footer&&0===t.input.value.length&&t.container.classList.remove("shopList_state_add")},t.handleKeyUp=function(){var e=t.input.value,n=e.length,o=n>0?"add":"remove";t.container.classList[o]("shopList_state_valid")},t.handleFocus=function(e){e.preventDefault(),t.submit(),t.input.focus()},t.submit=function(e){e&&e.preventDefault();var n=t.input.value,o=n.length;if(0===o)return!1;var i=t.shopList.length,s=0===i?0:i+1,r=!1;t.shopList.push({id:s,title:n,isOpen:r}),t.reset(),t.render(),t.updateLocalStorage()},t.reset=function(){t.form.reset()},t.render=function(){var e=document.createElement("ul");e.classList.add("shopListMain__list"),t.shopList.forEach(function(n){var o=document.createElement("li");o.classList.add("shopListMain__item"),o.innerHTML=t.template,o.querySelector(".shopListItem__content").setAttribute("data-id",n.id),o.querySelector(".shopListItem__content").innerHTML=n.title,o.querySelector(".shopListItem__btn_type_complete").setAttribute("data-id",n.id),n.isOpen&&o.querySelector(".shopListItem").classList.add("shopListItem_state_open"),e.appendChild(o)}),t.content.innerHTML="",t.content.appendChild(e)},t.updateLocalStorage=function(){var e=JSON.stringify(t.shopList);localStorage.setItem("shopList",e)},t.init=function(){t.getOptions(),t.setupListener(),t.loadData(),t.render()}},e=new t;window.addEventListener("load",function(){return e.init()}),document.addEventListener("deviceready",function(){return e.init()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4ubWluLmpzIiwic2hvcExpc3Qvc2hvcExpc3QuanMiXSwibmFtZXMiOlsiU2hvcExpc3QiLCJzZWxmIiwidGhpcyIsImdldE9wdGlvbnMiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwidGVtcGxhdGUiLCJpbm5lckhUTUwiLCJvcGVuRm9vdGVyQnRuIiwiZm9vdGVyIiwiaW5wdXQiLCJmb3JtIiwic3VibWl0QnRuIiwic2hvcExpc3QiLCJsb2FkRGF0YSIsImxvY2FsRGF0YSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJzZXR1cExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW5Gb290ZXIiLCJjbG9zZUZvb3RlciIsImhhbmRsZUtleVVwIiwic3VibWl0IiwiaGFuZGxlRm9jdXMiLCJyb3V0ZUNsaWNrIiwiZXZlbnQiLCJ0YXJnZXQiLCJtZXRob2QiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInRvZ2dsZUl0ZW1QYW5lbCIsImlkIiwiZ2V0QXR0cmlidXRlIiwibWFwIiwic2hvcEl0ZW0iLCJpc09wZW4iLCJyZW5kZXIiLCJjb21wbGV0ZSIsImZpbHRlciIsInVwZGF0ZUxvY2FsU3RvcmFnZSIsInByZXZlbnREZWZhdWx0IiwiYWRkIiwiZm9jdXMiLCJ2YWx1ZSIsImxlbmd0aCIsInJlbW92ZSIsInNob3BMaXN0TGVuZ3RoIiwicHVzaCIsInRpdGxlIiwicmVzZXQiLCJjb250ZW50TGlzdCIsImNyZWF0ZUVsZW1lbnQiLCJmb3JFYWNoIiwiaXRlbSIsImVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsImRhdGEiLCJzdHJpbmdpZnkiLCJzZXRJdGVtIiwiaW5pdCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IkFBQUEsY0NBQSxXQUtBLEdBQUFBLEdBQUEsV0FDQSxHQUFBQyxHQUFBQyxJQUtBRCxHQUFBRSxXQUFBLFdBQ0FGLEVBQUFHLFVBQUFD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RCxRQUNBckQsRUFBQXdDLFNBQ0F4QyxFQUFBMkMsc0JBTUEzQyxFQUFBcUQsTUFBQSxXQUNBckQsRUFBQVksS0FBQXlDLFNBTUFyRCxFQUFBd0MsT0FBQSxXQUNBLEdBQUFjLEdBQUFsRCxTQUFBbUQsY0FBQSxLQUVBRCxHQUFBdEIsVUFBQWEsSUFBQSxzQkFFQTdDLEVBQUFjLFNBQUEwQyxRQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQXRELFNBQUFtRCxjQUFBLEtBRUFHLEdBQUExQixVQUFBYSxJQUFBLHNCQUNBYSxFQUFBbEQsVUFBQVIsRUFBQU8sU0FFQW1ELEVBQUFyRCxjQUFBLDBCQUFBc0QsYUFBQSxVQUFBRixFQUFBdEIsSUFDQXVCLEVBQUFyRCxjQUFBLDBCQUFBRyxVQUFBaUQsRUFBQUwsTUFDQU0sRUFBQXJELGNBQUEsb0NBQUFzRCxhQUFBLFVBQUFGLEVBQUF0QixJQUVBc0IsRUFBQWxCLFFBRUFtQixFQUFBckQsY0FBQSxpQkFBQTJCLFVBQUFhLElBQUEsMkJBSUFTLEVBQUFNLFlBQUFGLEtBR0ExRCxFQUFBTSxRQUFBRSxVQUFBLEdBRUFSLEVBQUFNLFFBQUFzRCxZQUFBTixJQU1BdEQsRUFBQTJDLG1CQUFBLFdBQ0EsR0FBQWtCLEdBQUExQyxLQUFBMkMsVUFBQTlELEVBQUFjLFNBRUFHLGNBQUE4QyxRQUFBLFdBQUFGLElBTUE3RCxFQUFBZ0UsS0FBQSxXQUNBaEUsRUFBQUUsYUFDQUYsRUFBQXFCLGdCQUNBckIsRUFBQWUsV0FDQWYsRUFBQXdDLFdBSUExQixFQUFBLEdBQUFmLEVBRUFrRSxRQUFBM0MsaUJBQUEsT0FBQSxXQUFBLE1BQUFSLEdBQUFrRCxTQUNBNUQsU0FBQWtCLGlCQUFBLGNBQUEsV0FBQSxNQUFBUixHQUFBa0QiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTaG9wTGlzdCBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICB2YXIgU2hvcExpc3QgPSBmdW5jdGlvbiBTaG9wTGlzdCgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgb3B0aW9ucyBmb3IgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldE9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdCcpO1xuICAgICAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0TWFpbl9fY29udGVudCcpO1xuICAgICAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaG9wTGlzdEl0ZW0nKS5pbm5lckhUTUw7XG4gICAgICAgICAgICBzZWxmLm9wZW5Gb290ZXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RNYWluX19vcGVuJyk7XG4gICAgICAgICAgICBzZWxmLmZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3RlcicpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9faW5wdXQnKTtcbiAgICAgICAgICAgIHNlbGYuZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9fZm9ybScpO1xuICAgICAgICAgICAgc2VsZi5zdWJtaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2J0bi5zaG9wTGlzdEZvb3Rlcl9fYnRuX3R5cGVfc3VibWl0Jyk7XG4gICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gW107XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIGlmIHRoZXJlIGRhdGEgaW4gbG9jYWwgc3RvcmFnZSBhbmQgbG9hZCBpdFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5sb2FkRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBsb2NhbERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2hvcExpc3QnKTtcblxuICAgICAgICAgICAgaWYgKGxvY2FsRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IEpTT04ucGFyc2UobG9jYWxEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50cyBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYub3BlbkZvb3RlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYub3BlbkZvb3Rlcik7XG4gICAgICAgICAgICBzZWxmLmZvb3Rlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuY2xvc2VGb290ZXIpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHNlbGYuaGFuZGxlS2V5VXApO1xuICAgICAgICAgICAgc2VsZi5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHNlbGYuc3VibWl0KTtcbiAgICAgICAgICAgIHNlbGYuc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5oYW5kbGVGb2N1cyk7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVDbGljayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlcyBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucm91dGVDbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSAnJztcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fY29udGVudCcpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAndG9nZ2xlSXRlbVBhbmVsJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2hvcExpc3RJdGVtX19idG5fdHlwZV9jb21wbGV0ZScpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAnY29tcGxldGUnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWV0aG9kKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmW21ldGhvZF0oZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb2dnbGUgc2hvcCBpdGVtIHBhbmVsXG4gICAgICAgICAqIEBwYXJhbSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi50b2dnbGVJdGVtUGFuZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IHNlbGYuc2hvcExpc3QubWFwKGZ1bmN0aW9uIChzaG9wSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3BJdGVtLmlkID09IGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9wSXRlbS5pc09wZW4gPSAhc2hvcEl0ZW0uaXNPcGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmUgc2hvcCBpdGVtIGZyb20gbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY29tcGxldGUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICB2YXIgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG5cbiAgICAgICAgICAgIGlmIChpZCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IHNlbGYuc2hvcExpc3QuZmlsdGVyKGZ1bmN0aW9uIChzaG9wSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW0uaWQgIT0gaWQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgZm9vdGVyIHdpdGggaW5wdXQgZmllbGRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLm9wZW5Gb290ZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0X3N0YXRlX2FkZCcpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5mb2N1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9zZSBmb290ZXIgaWYgY2xpY2sgb3V0c2lkZSBvZiBmb290ZXIgaW5wdXRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmNsb3NlRm9vdGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBzZWxmLmZvb3RlciAmJiBzZWxmLmlucHV0LnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIGlmIGlucHV0IHZhbHVlIGxlbmd0aCA+IDAgYW5kIGNoYW5nZSBjb250YWluZXIgc3RhdGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlS2V5VXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxmLmlucHV0LnZhbHVlO1xuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSBsZW5ndGggPiAwID8gJ2FkZCcgOiAncmVtb3ZlJztcblxuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0W21ldGhvZF0oJ3Nob3BMaXN0X3N0YXRlX3ZhbGlkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXAgaW5wdXQgZm9jdXNcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZUZvY3VzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBzZWxmLnN1Ym1pdCgpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5mb2N1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgZm9ybSBzdWJtaXNzaW9uLiBBZGQgbmV3IGl0ZW0gdG8gc2hvcCBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zdWJtaXQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudCkge1xuXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHZhbHVlID0gc2VsZi5pbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmIChsZW5ndGggPT09IDApIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNob3BMaXN0TGVuZ3RoID0gc2VsZi5zaG9wTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgaWQgPSBzaG9wTGlzdExlbmd0aCA9PT0gMCA/IDAgOiBzaG9wTGlzdExlbmd0aCArIDE7XG4gICAgICAgICAgICB2YXIgaXNPcGVuID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICBpc09wZW46IGlzT3BlblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGYucmVzZXQoKTtcbiAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICBzZWxmLnVwZGF0ZUxvY2FsU3RvcmFnZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXNldCBmb3JtXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5mb3JtLnJlc2V0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBzaG9wIGxpc3RcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRlbnRMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcblxuICAgICAgICAgICAgY29udGVudExpc3QuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3RNYWluX19saXN0Jyk7XG5cbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3RNYWluX19pdGVtJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBzZWxmLnRlbXBsYXRlO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtX19jb250ZW50Jykuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgaXRlbS5pZCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtX19jb250ZW50JykuaW5uZXJIVE1MID0gaXRlbS50aXRsZTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2NvbXBsZXRlJykuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgaXRlbS5pZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc09wZW4pIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW0nKS5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdEl0ZW1fc3RhdGVfb3BlbicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnRlbnRMaXN0LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnRMaXN0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnN0cmluZ2lmeShzZWxmLnNob3BMaXN0KTtcblxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Nob3BMaXN0JywgZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmdldE9wdGlvbnMoKTtcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuICAgICAgICAgICAgc2VsZi5sb2FkRGF0YSgpO1xuICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNob3BMaXN0ID0gbmV3IFNob3BMaXN0KCk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNob3BMaXN0LmluaXQoKTtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkZXZpY2VyZWFkeScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNob3BMaXN0LmluaXQoKTtcbiAgICB9KTtcbn0pKCk7IiwiKCgpID0+IHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNob3BMaXN0IGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIGNvbnN0IFNob3BMaXN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgb3B0aW9ucyBmb3IgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldE9wdGlvbnMgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdCcpO1xuICAgICAgICAgICAgc2VsZi5jb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0TWFpbl9fY29udGVudCcpO1xuICAgICAgICAgICAgc2VsZi50ZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaG9wTGlzdEl0ZW0nKS5pbm5lckhUTUw7XG4gICAgICAgICAgICBzZWxmLm9wZW5Gb290ZXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RNYWluX19vcGVuJyk7XG4gICAgICAgICAgICBzZWxmLmZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3RlcicpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9faW5wdXQnKTtcbiAgICAgICAgICAgIHNlbGYuZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9fZm9ybScpO1xuICAgICAgICAgICAgc2VsZi5zdWJtaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2J0bi5zaG9wTGlzdEZvb3Rlcl9fYnRuX3R5cGVfc3VibWl0Jyk7XG4gICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gW107XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIGlmIHRoZXJlIGRhdGEgaW4gbG9jYWwgc3RvcmFnZSBhbmQgbG9hZCBpdFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5sb2FkRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3QgbG9jYWxEYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Nob3BMaXN0Jyk7XG5cbiAgICAgICAgICAgIGlmIChsb2NhbERhdGEpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBKU09OLnBhcnNlKGxvY2FsRGF0YSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkIGV2ZW50cyBsaXN0ZW5lcnNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYub3BlbkZvb3RlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYub3BlbkZvb3Rlcik7XG4gICAgICAgICAgICBzZWxmLmZvb3Rlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuY2xvc2VGb290ZXIpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHNlbGYuaGFuZGxlS2V5VXApO1xuICAgICAgICAgICAgc2VsZi5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHNlbGYuc3VibWl0KTtcbiAgICAgICAgICAgIHNlbGYuc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5oYW5kbGVGb2N1cyk7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVDbGljayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlcyBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucm91dGVDbGljayA9IGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGxldCBtZXRob2QgPSAnJztcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fY29udGVudCcpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAndG9nZ2xlSXRlbVBhbmVsJztcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2NvbXBsZXRlJykpIHtcblxuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICdjb21wbGV0ZSc7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1ldGhvZCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZlttZXRob2RdKGV2ZW50KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb2dnbGUgc2hvcCBpdGVtIHBhbmVsXG4gICAgICAgICAqIEBwYXJhbSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi50b2dnbGVJdGVtUGFuZWwgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKSkge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gc2VsZi5zaG9wTGlzdC5tYXAoc2hvcEl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3BJdGVtLmlkID09IGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9wSXRlbS5pc09wZW4gPSAhc2hvcEl0ZW0uaXNPcGVuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaG9wSXRlbTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmUgc2hvcCBpdGVtIGZyb20gbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY29tcGxldGUgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICBjb25zdCBpZCA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcblxuICAgICAgICAgICAgaWYgKGlkKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gc2VsZi5zaG9wTGlzdC5maWx0ZXIoc2hvcEl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW0uaWQgIT0gaWQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IGZvb3RlciB3aXRoIGlucHV0IGZpZWxkXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5vcGVuRm9vdGVyID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG4gICAgICAgICAgICBzZWxmLmlucHV0LmZvY3VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsb3NlIGZvb3RlciBpZiBjbGljayBvdXRzaWRlIG9mIGZvb3RlciBpbnB1dFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY2xvc2VGb290ZXIgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBzZWxmLmZvb3RlciAmJiBzZWxmLmlucHV0LnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgaW5wdXQgdmFsdWUgbGVuZ3RoID4gMCBhbmQgY2hhbmdlIGNvbnRhaW5lciBzdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVLZXlVcCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2VsZi5pbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IG1ldGhvZCA9IGxlbmd0aCA+IDAgPyAnYWRkJyA6ICdyZW1vdmUnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3RbbWV0aG9kXSgnc2hvcExpc3Rfc3RhdGVfdmFsaWQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcCBpbnB1dCBmb2N1c1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlRm9jdXMgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBzZWxmLnN1Ym1pdCgpO1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5mb2N1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgZm9ybSBzdWJtaXNzaW9uLiBBZGQgbmV3IGl0ZW0gdG8gc2hvcCBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zdWJtaXQgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzZWxmLmlucHV0LnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gdmFsdWUubGVuZ3RoO1xuXG4gICAgICAgICAgICBpZiAobGVuZ3RoID09PSAwKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgc2hvcExpc3RMZW5ndGggPSBzZWxmLnNob3BMaXN0Lmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gc2hvcExpc3RMZW5ndGggPT09IDAgPyAwIDogc2hvcExpc3RMZW5ndGggKyAxO1xuICAgICAgICAgICAgY29uc3QgaXNPcGVuID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICBpc09wZW46IGlzT3BlblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGYucmVzZXQoKTtcbiAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICBzZWxmLnVwZGF0ZUxvY2FsU3RvcmFnZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXNldCBmb3JtXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlc2V0ID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5mb3JtLnJlc2V0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlciBzaG9wIGxpc3RcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG5cbiAgICAgICAgICAgIGNvbnRlbnRMaXN0LmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0TWFpbl9fbGlzdCcpO1xuXG4gICAgICAgICAgICBzZWxmLnNob3BMaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdE1haW5fX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKS5pbm5lckhUTUwgPSBpdGVtLnRpdGxlO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbV9fYnRuX3R5cGVfY29tcGxldGUnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzT3Blbikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbScpLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0SXRlbV9zdGF0ZV9vcGVuJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb250ZW50TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50TGlzdCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZSBsb2NhbCBzdG9yYWdlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnVwZGF0ZUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHNlbGYuc2hvcExpc3QpO1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2hvcExpc3QnLCBkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuZ2V0T3B0aW9ucygpO1xuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG4gICAgICAgICAgICBzZWxmLmxvYWREYXRhKCk7XG4gICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjb25zdCBzaG9wTGlzdCA9IG5ldyBTaG9wTGlzdCgpO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiBzaG9wTGlzdC5pbml0KCkpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZXJlYWR5JywgKCkgPT4gc2hvcExpc3QuaW5pdCgpKTtcbn0pKCk7XG4iXX0=

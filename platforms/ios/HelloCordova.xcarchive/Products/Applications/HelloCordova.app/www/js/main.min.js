"use strict";!function(){var t=function(){var t=this;t.getOptions=function(){t.container=document.querySelector(".shopList"),t.content=document.querySelector(".shopListMain__content"),t.template=document.querySelector("#shopListItem").innerHTML,t.openFooterBtn=document.querySelector(".shopListMain__open"),t.footer=document.querySelector(".shopListFooter"),t.input=document.querySelector(".shopListFooter__input"),t.hidden=document.querySelector(".shopListFooter__hidden"),t.form=document.querySelector(".shopListFooter__form"),t.submitBtn=document.querySelector(".shopListFooter__btn.shopListFooter__btn_type_submit"),t.shopList=[]},t.loadData=function(){var e=localStorage.getItem("shopList");e&&(t.shopList=JSON.parse(e))},t.setupListener=function(){t.openFooterBtn.addEventListener("click",function(e){e.preventDefault(),t.openFooter()}),t.footer.addEventListener("click",function(e){e.target===t.footer&&0===t.input.value.length&&t.closeFooter()}),t.input.addEventListener("keyup",t.handleKeyUp),t.form.addEventListener("submit",t.submit),t.submitBtn.addEventListener("click",t.handleFocus),t.container.addEventListener("click",t.routeClick)},t.routeClick=function(e){var n=e.target,o="";n.classList.contains("shopListItem__content")?o="toggleItemPanel":n.classList.contains("shopListItem__btn_type_complete")?o="complete":n.classList.contains("shopListItem__btn_type_edit")&&(o="edit"),o&&t[o](e)},t.toggleItemPanel=function(e){var n=e.target;if(n.classList.contains("shopListItem__content")){var o=n.getAttribute("data-id");o&&(t.shopList=t.shopList.map(function(t){return t.id==o&&(t.isOpen=!t.isOpen),t}),t.render(),t.updateLocalStorage())}},t.complete=function(e){var n=e.target,o=n.getAttribute("data-id");o&&(t.shopList=t.shopList.filter(function(t){return t.id!=o}),t.render(),t.updateLocalStorage())},t.edit=function(e){var n=e.target,o=n.getAttribute("data-id"),i=t.shopList.find(function(t){return t.id==o});o&&i&&(t.input.value=i.title,t.hidden.value=o,t.openFooter())},t.openFooter=function(){t.container.classList.add("shopList_state_add"),setTimeout(function(){t.initFocus()},300)},t.closeFooter=function(){t.container.classList.remove("shopList_state_add")},t.handleKeyUp=function(){var e=t.input.value,n=e.length,o=n>0?"add":"remove";t.container.classList[o]("shopList_state_valid")},t.handleFocus=function(e){e.preventDefault(),t.submit()},t.initFocus=function(){t.input.focus()},t.submit=function(e){e&&e.preventDefault();var n=t.input.value,o=t.hidden.value,i=n.length;if(0===i)return!1;var s=t.shopList.length,r=o?o:"0"===s?"0":""+(s+1),a=!1,c=t.shopList.find(function(t){return t.id==r});c?(c.title=n,t.closeFooter()):t.shopList.push({id:r,title:n,isOpen:a}),t.reset(),t.render(),t.updateLocalStorage()},t.reset=function(){t.form.reset(),t.hidden.value=""},t.render=function(){var e=document.createElement("ul");e.classList.add("shopListMain__list"),t.shopList.forEach(function(n){var o=document.createElement("li");o.classList.add("shopListMain__item"),o.innerHTML=t.template,o.querySelector(".shopListItem__content").setAttribute("data-id",n.id),o.querySelector(".shopListItem__content").innerHTML=n.title,o.querySelector(".shopListItem__btn_type_complete").setAttribute("data-id",n.id),o.querySelector(".shopListItem__btn_type_edit").setAttribute("data-id",n.id),n.isOpen&&o.querySelector(".shopListItem").classList.add("shopListItem_state_open"),e.appendChild(o)}),t.content.innerHTML="",t.content.appendChild(e)},t.updateLocalStorage=function(){var e=JSON.stringify(t.shopList);localStorage.setItem("shopList",e)},t.init=function(){t.getOptions(),t.setupListener(),t.loadData(),t.render()}},e=new t;window.addEventListener("load",function(){return e.init()}),document.addEventListener("deviceready",function(){return e.init()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4ubWluLmpzIiwic2hvcExpc3Qvc2hvcExpc3QuanMiXSwibmFtZXMiOlsiU2hvcExpc3QiLCJzZWxmIiwidGhpcyIsImdldE9wdGlvbnMiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwidGVtcGxhdGUiLCJpbm5lckhUTUwiLCJvcGVuRm9vdGVyQnRuIiwiZm9vdGVyIiwiaW5wdXQiLCJoaWRkZW4iLCJmb3JtIiwic3VibWl0QnRuIiwic2hvcExpc3QiLCJsb2FkRGF0YSIsImxvY2FsRGF0YSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJzZXR1cExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJvcGVuRm9vdGVyIiwidGFyZ2V0IiwidmFsdWUiLCJsZW5ndGgiLCJjbG9zZUZvb3RlciIsImhhbmRsZUtleVVwIiwic3VibWl0IiwiaGFuZGxlRm9jdXMiLCJyb3V0ZUNsaWNrIiwibWV0aG9kIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJ0b2dnbGVJdGVtUGFuZWwiLCJpZCIsImdldEF0dHJpYnV0ZSIsIm1hcCIsInNob3BJdGVtIiwiaXNPcGVuIiwicmVuZGVyIiwidXBkYXRlTG9jYWxTdG9yYWdlIiwiY29tcGxldGUiLCJmaWx0ZXIiLCJlZGl0IiwiZmluZCIsInRpdGxlIiwiYWRkIiwic2V0VGltZW91dCIsImluaXRGb2N1cyIsInJlbW92ZSIsImZvY3VzIiwiaGlkZGVuVmFsdWUiLCJzaG9wTGlzdExlbmd0aCIsIml0ZW0iLCJwdXNoIiwicmVzZXQiLCJjb250ZW50TGlzdCIsImNyZWF0ZUVsZW1lbnQiLCJmb3JFYWNoIiwiZWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiZGF0YSIsInN0cmluZ2lmeSIsInNldEl0ZW0iLCJpbml0Iiwid2luZG93Il0sIm1hcHBpbmdzIjoiQUFBQSxjQ0FBLFdBS0Es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RCxFQUFBUixNQUNBYyxFQUFBM0QsY0FBQSxvQ0FBQTRELGFBQUEsVUFBQVAsRUFBQW5CLElBQ0F5QixFQUFBM0QsY0FBQSxnQ0FBQTRELGFBQUEsVUFBQVAsRUFBQW5CLElBRUFtQixFQUFBZixRQUVBcUIsRUFBQTNELGNBQUEsaUJBQUErQixVQUFBZSxJQUFBLDJCQUlBVSxFQUFBSyxZQUFBRixLQUdBaEUsRUFBQU0sUUFBQUUsVUFBQSxHQUVBUixFQUFBTSxRQUFBNEQsWUFBQUwsSUFNQTdELEVBQUE2QyxtQkFBQSxXQUNBLEdBQUFzQixHQUFBL0MsS0FBQWdELFVBQUFwRSxFQUFBZSxTQUVBRyxjQUFBbUQsUUFBQSxXQUFBRixJQU1BbkUsRUFBQXNFLEtBQUEsV0FDQXRFLEVBQUFFLGFBQ0FGLEVBQUFzQixnQkFDQXRCLEVBQUFnQixXQUNBaEIsRUFBQTRDLFdBSUE3QixFQUFBLEdBQUFoQixFQUVBd0UsUUFBQWhELGlCQUFBLE9BQUEsV0FBQSxNQUFBUixHQUFBdUQsU0FDQWxFLFNBQUFtQixpQkFBQSxjQUFBLFdBQUEsTUFBQVIsR0FBQXVEIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2hvcExpc3QgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIFNob3BMaXN0ID0gZnVuY3Rpb24gU2hvcExpc3QoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IG9wdGlvbnMgZm9yIG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXRPcHRpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3QnKTtcbiAgICAgICAgICAgIHNlbGYuY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdE1haW5fX2NvbnRlbnQnKTtcbiAgICAgICAgICAgIHNlbGYudGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2hvcExpc3RJdGVtJykuaW5uZXJIVE1MO1xuICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0TWFpbl9fb3BlbicpO1xuICAgICAgICAgICAgc2VsZi5mb290ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXInKTtcbiAgICAgICAgICAgIHNlbGYuaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2lucHV0Jyk7XG4gICAgICAgICAgICBzZWxmLmhpZGRlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9faGlkZGVuJyk7XG4gICAgICAgICAgICBzZWxmLmZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2Zvcm0nKTtcbiAgICAgICAgICAgIHNlbGYuc3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19idG4uc2hvcExpc3RGb290ZXJfX2J0bl90eXBlX3N1Ym1pdCcpO1xuICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IFtdO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVjayBpZiB0aGVyZSBkYXRhIGluIGxvY2FsIHN0b3JhZ2UgYW5kIGxvYWQgaXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYubG9hZERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbG9jYWxEYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Nob3BMaXN0Jyk7XG5cbiAgICAgICAgICAgIGlmIChsb2NhbERhdGEpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBKU09OLnBhcnNlKGxvY2FsRGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLm9wZW5Gb290ZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHNlbGYub3BlbkZvb3RlcigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZWxmLmZvb3Rlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHNlbGYuZm9vdGVyICYmIHNlbGYuaW5wdXQudmFsdWUubGVuZ3RoID09PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbG9zZUZvb3RlcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHNlbGYuaGFuZGxlS2V5VXApO1xuICAgICAgICAgICAgc2VsZi5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHNlbGYuc3VibWl0KTtcbiAgICAgICAgICAgIHNlbGYuc3VibWl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5oYW5kbGVGb2N1cyk7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVDbGljayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlcyBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucm91dGVDbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSAnJztcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fY29udGVudCcpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAndG9nZ2xlSXRlbVBhbmVsJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2hvcExpc3RJdGVtX19idG5fdHlwZV9jb21wbGV0ZScpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAnY29tcGxldGUnO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2VkaXQnKSkge1xuXG4gICAgICAgICAgICAgICAgbWV0aG9kID0gJ2VkaXQnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWV0aG9kKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmW21ldGhvZF0oZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb2dnbGUgc2hvcCBpdGVtIHBhbmVsXG4gICAgICAgICAqIEBwYXJhbSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi50b2dnbGVJdGVtUGFuZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IHNlbGYuc2hvcExpc3QubWFwKGZ1bmN0aW9uIChzaG9wSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3BJdGVtLmlkID09IGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9wSXRlbS5pc09wZW4gPSAhc2hvcEl0ZW0uaXNPcGVuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmUgc2hvcCBpdGVtIGZyb20gbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY29tcGxldGUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICB2YXIgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG5cbiAgICAgICAgICAgIGlmIChpZCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IHNlbGYuc2hvcExpc3QuZmlsdGVyKGZ1bmN0aW9uIChzaG9wSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW0uaWQgIT0gaWQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVkaXQgc2hvcCBpdGVtIGNvbnRlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmVkaXQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICB2YXIgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxmLnNob3BMaXN0LmZpbmQoZnVuY3Rpb24gKHNob3BJdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNob3BJdGVtLmlkID09IGlkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChpZCAmJiB2YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9IHZhbHVlLnRpdGxlO1xuICAgICAgICAgICAgICAgIHNlbGYuaGlkZGVuLnZhbHVlID0gaWQ7XG5cbiAgICAgICAgICAgICAgICBzZWxmLm9wZW5Gb290ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBmb290ZXIgd2l0aCBpbnB1dCBmaWVsZFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5vcGVuRm9vdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYuaW5pdEZvY3VzKCk7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9zZSBmb290ZXIgaWYgY2xpY2sgb3V0c2lkZSBvZiBmb290ZXIgaW5wdXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY2xvc2VGb290ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG9wTGlzdF9zdGF0ZV9hZGQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgaW5wdXQgdmFsdWUgbGVuZ3RoID4gMCBhbmQgY2hhbmdlIGNvbnRhaW5lciBzdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVLZXlVcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlbGYuaW5wdXQudmFsdWU7XG4gICAgICAgICAgICB2YXIgbGVuZ3RoID0gdmFsdWUubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIG1ldGhvZCA9IGxlbmd0aCA+IDAgPyAnYWRkJyA6ICdyZW1vdmUnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3RbbWV0aG9kXSgnc2hvcExpc3Rfc3RhdGVfdmFsaWQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcCBpbnB1dCBmb2N1c1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlRm9jdXMgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIHNlbGYuc3VibWl0KCk7XG4gICAgICAgICAgICAvLyBzZWxmLmlucHV0LmZvY3VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCBmb2N1cyBvbiBpbnB1dFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0Rm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmlucHV0LmZvY3VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZSBmb3JtIHN1Ym1pc3Npb24uIEFkZCBuZXcgaXRlbSB0byBzaG9wIGxpc3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnN1Ym1pdCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxmLmlucHV0LnZhbHVlO1xuICAgICAgICAgICAgdmFyIGhpZGRlblZhbHVlID0gc2VsZi5oaWRkZW4udmFsdWU7XG4gICAgICAgICAgICB2YXIgbGVuZ3RoID0gdmFsdWUubGVuZ3RoO1xuXG4gICAgICAgICAgICBpZiAobGVuZ3RoID09PSAwKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzaG9wTGlzdExlbmd0aCA9IHNlbGYuc2hvcExpc3QubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIGlkID0gaGlkZGVuVmFsdWUgPyBoaWRkZW5WYWx1ZSA6IHNob3BMaXN0TGVuZ3RoID09PSAnMCcgPyAnMCcgOiAnJyArIChzaG9wTGlzdExlbmd0aCArIDEpO1xuICAgICAgICAgICAgdmFyIGlzT3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxmLnNob3BMaXN0LmZpbmQoZnVuY3Rpb24gKHNob3BJdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNob3BJdGVtLmlkID09IGlkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChpdGVtKSB7XG5cbiAgICAgICAgICAgICAgICBpdGVtLnRpdGxlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgc2VsZi5jbG9zZUZvb3RlcigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2hvcExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBpc09wZW46IGlzT3BlblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxmLnJlc2V0KCk7XG4gICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVzZXQgZm9ybVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZm9ybS5yZXNldCgpO1xuICAgICAgICAgICAgc2VsZi5oaWRkZW4udmFsdWUgPSAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNob3AgbGlzdFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdE1haW5fX2xpc3QnKTtcblxuICAgICAgICAgICAgc2VsZi5zaG9wTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdE1haW5fX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKS5pbm5lckhUTUwgPSBpdGVtLnRpdGxlO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbV9fYnRuX3R5cGVfY29tcGxldGUnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2VkaXQnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzT3Blbikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbScpLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0SXRlbV9zdGF0ZV9vcGVuJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudExpc3QpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVcGRhdGUgbG9jYWwgc3RvcmFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHNlbGYuc2hvcExpc3QpO1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2hvcExpc3QnLCBkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0T3B0aW9ucygpO1xuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG4gICAgICAgICAgICBzZWxmLmxvYWREYXRhKCk7XG4gICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgc2hvcExpc3QgPSBuZXcgU2hvcExpc3QoKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2hvcExpc3QuaW5pdCgpO1xuICAgIH0pO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZXJlYWR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2hvcExpc3QuaW5pdCgpO1xuICAgIH0pO1xufSkoKTsiLCIoKCkgPT4ge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2hvcExpc3QgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgY29uc3QgU2hvcExpc3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBvcHRpb25zIGZvciBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0T3B0aW9ucyA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Jyk7XG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RNYWluX19jb250ZW50Jyk7XG4gICAgICAgICAgICBzZWxmLnRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Nob3BMaXN0SXRlbScpLmlubmVySFRNTDtcbiAgICAgICAgICAgIHNlbGYub3BlbkZvb3RlckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdE1haW5fX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuZm9vdGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyJyk7XG4gICAgICAgICAgICBzZWxmLmlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19pbnB1dCcpO1xuICAgICAgICAgICAgc2VsZi5oaWRkZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2hpZGRlbicpO1xuICAgICAgICAgICAgc2VsZi5mb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19mb3JtJyk7XG4gICAgICAgICAgICBzZWxmLnN1Ym1pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9fYnRuLnNob3BMaXN0Rm9vdGVyX19idG5fdHlwZV9zdWJtaXQnKTtcbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgdGhlcmUgZGF0YSBpbiBsb2NhbCBzdG9yYWdlIGFuZCBsb2FkIGl0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmxvYWREYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBsb2NhbERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2hvcExpc3QnKTtcblxuICAgICAgICAgICAgaWYgKGxvY2FsRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IEpTT04ucGFyc2UobG9jYWxEYXRhKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlbGYuZm9vdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHNlbGYuZm9vdGVyICYmIHNlbGYuaW5wdXQudmFsdWUubGVuZ3RoID09PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbG9zZUZvb3RlcigpO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZWxmLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgc2VsZi5oYW5kbGVLZXlVcCk7XG4gICAgICAgICAgICBzZWxmLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0Jywgc2VsZi5zdWJtaXQpO1xuICAgICAgICAgICAgc2VsZi5zdWJtaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLmhhbmRsZUZvY3VzKTtcbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5yb3V0ZUNsaWNrKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUm91dGVzIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yb3V0ZUNsaWNrID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgbGV0IG1ldGhvZCA9ICcnO1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2hvcExpc3RJdGVtX19jb250ZW50JykpIHtcblxuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICd0b2dnbGVJdGVtUGFuZWwnO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fYnRuX3R5cGVfY29tcGxldGUnKSkge1xuXG4gICAgICAgICAgICAgICAgbWV0aG9kID0gJ2NvbXBsZXRlJztcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2VkaXQnKSkge1xuXG4gICAgICAgICAgICAgICAgbWV0aG9kID0gJ2VkaXQnO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtZXRob2QpIHtcblxuICAgICAgICAgICAgICAgIHNlbGZbbWV0aG9kXShldmVudCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVG9nZ2xlIHNob3AgaXRlbSBwYW5lbFxuICAgICAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYudG9nZ2xlSXRlbVBhbmVsID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2hvcExpc3RJdGVtX19jb250ZW50JykpIHtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IHNlbGYuc2hvcExpc3QubWFwKHNob3BJdGVtID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG9wSXRlbS5pZCA9PSBpZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcEl0ZW0uaXNPcGVuID0gIXNob3BJdGVtLmlzT3BlbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlKCk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVtb3ZlIHNob3AgaXRlbSBmcm9tIGxpc3RcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmNvbXBsZXRlID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgY29uc3QgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG5cbiAgICAgICAgICAgIGlmIChpZCkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IHNlbGYuc2hvcExpc3QuZmlsdGVyKHNob3BJdGVtID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNob3BJdGVtLmlkICE9IGlkO1xuICAgICAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRWRpdCBzaG9wIGl0ZW0gY29udGVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZWRpdCA9IGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzZWxmLnNob3BMaXN0LmZpbmQoc2hvcEl0ZW0gPT4gc2hvcEl0ZW0uaWQgPT0gaWQpO1xuXG4gICAgICAgICAgICBpZiAoaWQgJiYgdmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSB2YWx1ZS50aXRsZTtcbiAgICAgICAgICAgICAgICBzZWxmLmhpZGRlbi52YWx1ZSA9IGlkO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBmb290ZXIgd2l0aCBpbnB1dCBmaWVsZFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5vcGVuRm9vdGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNlbGYuaW5pdEZvY3VzKCk7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9zZSBmb290ZXIgaWYgY2xpY2sgb3V0c2lkZSBvZiBmb290ZXIgaW5wdXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY2xvc2VGb290ZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG9wTGlzdF9zdGF0ZV9hZGQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgaW5wdXQgdmFsdWUgbGVuZ3RoID4gMCBhbmQgY2hhbmdlIGNvbnRhaW5lciBzdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVLZXlVcCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2VsZi5pbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IG1ldGhvZCA9IGxlbmd0aCA+IDAgPyAnYWRkJyA6ICdyZW1vdmUnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3RbbWV0aG9kXSgnc2hvcExpc3Rfc3RhdGVfdmFsaWQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcCBpbnB1dCBmb2N1c1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlRm9jdXMgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBzZWxmLnN1Ym1pdCgpO1xuICAgICAgICAgICAgLy8gc2VsZi5pbnB1dC5mb2N1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgZm9jdXMgb24gaW5wdXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdEZvY3VzID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5pbnB1dC5mb2N1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGUgZm9ybSBzdWJtaXNzaW9uLiBBZGQgbmV3IGl0ZW0gdG8gc2hvcCBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zdWJtaXQgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzZWxmLmlucHV0LnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgaGlkZGVuVmFsdWUgPSBzZWxmLmhpZGRlbi52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcblxuICAgICAgICAgICAgaWYgKGxlbmd0aCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHNob3BMaXN0TGVuZ3RoID0gc2VsZi5zaG9wTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBpZCA9IGhpZGRlblZhbHVlID8gaGlkZGVuVmFsdWUgOiAoc2hvcExpc3RMZW5ndGggPT09ICcwJykgPyAnMCcgOiAnJyArIChzaG9wTGlzdExlbmd0aCArIDEpO1xuICAgICAgICAgICAgY29uc3QgaXNPcGVuID0gZmFsc2U7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gc2VsZi5zaG9wTGlzdC5maW5kKHNob3BJdGVtID0+IHNob3BJdGVtLmlkID09IGlkKTtcblxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcblxuICAgICAgICAgICAgICAgIGl0ZW0udGl0bGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlRm9vdGVyKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnNob3BMaXN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgaXNPcGVuOiBpc09wZW5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxmLnJlc2V0KCk7XG4gICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVzZXQgZm9ybVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZXNldCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuZm9ybS5yZXNldCgpO1xuICAgICAgICAgICAgc2VsZi5oaWRkZW4udmFsdWUgPSAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNob3AgbGlzdFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRMaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcblxuICAgICAgICAgICAgY29udGVudExpc3QuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3RNYWluX19saXN0Jyk7XG5cbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0TWFpbl9faXRlbScpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gc2VsZi50ZW1wbGF0ZTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbV9fY29udGVudCcpLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIGl0ZW0uaWQpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbV9fY29udGVudCcpLmlubmVySFRNTCA9IGl0ZW0udGl0bGU7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtX19idG5fdHlwZV9jb21wbGV0ZScpLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIGl0ZW0uaWQpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbV9fYnRuX3R5cGVfZWRpdCcpLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIGl0ZW0uaWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaXNPcGVuKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtJykuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3RJdGVtX3N0YXRlX29wZW4nKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnRlbnRMaXN0LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNlbGYuY29udGVudC5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnRMaXN0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5zdHJpbmdpZnkoc2VsZi5zaG9wTGlzdCk7XG5cbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzaG9wTGlzdCcsIGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0IG1vZHVsZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5nZXRPcHRpb25zKCk7XG4gICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcbiAgICAgICAgICAgIHNlbGYubG9hZERhdGEoKTtcbiAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGNvbnN0IHNob3BMaXN0ID0gbmV3IFNob3BMaXN0KCk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHNob3BMaXN0LmluaXQoKSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlcmVhZHknLCAoKSA9PiBzaG9wTGlzdC5pbml0KCkpO1xufSkoKTtcbiJdfQ==

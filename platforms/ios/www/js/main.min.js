"use strict";!function(){var t=function(){var t=this;t.getOptions=function(){t.container=document.querySelector(".shopList"),t.content=document.querySelector(".shopListMain__content"),t.template=document.querySelector("#shopListItem").innerHTML,t.openFooterBtn=document.querySelector(".shopListMain__open"),t.footer=document.querySelector(".shopListFooter"),t.input=document.querySelector(".shopListFooter__input"),t.hidden=document.querySelector(".shopListFooter__hidden"),t.form=document.querySelector(".shopListFooter__form"),t.submitBtn=document.querySelector(".shopListFooter__btn.shopListFooter__btn_type_submit"),t.shopList=[]},t.loadData=function(){var e=localStorage.getItem("shopList");e&&(t.shopList=JSON.parse(e))},t.setupListener=function(){t.openFooterBtn.addEventListener("click",function(e){e.preventDefault(),t.openFooter()}),t.footer.addEventListener("click",function(e){e.target===t.footer&&0===t.input.value.length&&t.closeFooter()}),t.input.addEventListener("keyup",t.handleKeyUp),t.form.addEventListener("submit",t.submit),t.submitBtn.addEventListener("click",t.handleSubmitBtn),t.container.addEventListener("click",t.routeClick)},t.routeClick=function(e){var n=e.target,i="";n.classList.contains("shopListItem__content")?i="toggleItemPanel":n.classList.contains("shopListItem__btn_type_complete")?i="complete":n.classList.contains("shopListItem__btn_type_edit")&&(i="edit"),i&&t[i](e)},t.toggleItemPanel=function(e){var n=e.target;if(n.classList.contains("shopListItem__content")){var i=n.getAttribute("data-id");i&&(t.shopList=t.shopList.map(function(t){return t.id==i&&(t.isOpen=!t.isOpen),t}),t.render(),t.updateLocalStorage())}},t.complete=function(e){var n=e.target,i=n.getAttribute("data-id");i&&(t.shopList=t.shopList.filter(function(t){return t.id!=i}),t.render(),t.updateLocalStorage())},t.edit=function(e){var n=e.target,i=n.getAttribute("data-id"),o=t.shopList.find(function(t){return t.id==i});i&&o&&(t.input.value=o.title,t.hidden.value=i,t.container.classList.add("shopList_state_valid"),t.openFooter())},t.openFooter=function(){t.container.classList.add("shopList_state_add"),setTimeout(function(){t.initFocus()},300)},t.closeFooter=function(){t.container.classList.remove("shopList_state_add")},t.handleKeyUp=function(){var e=t.input.value,n=e.length,i=n>0?"add":"remove";t.container.classList[i]("shopList_state_valid")},t.handleSubmitBtn=function(e){t.submit()},t.initFocus=function(){t.input.focus()},t.submit=function(e){e&&e.preventDefault();var n=t.input.value,i=t.hidden.value,o=n.length;if(0===o)return!1;var s=t.shopList.length,r=i?i:"0"===s?"0":""+(s+1),a=!1,c=t.shopList.find(function(t){return t.id==r});c?(c.title=n,t.closeFooter()):t.shopList.push({id:r,title:n,isOpen:a}),t.reset(),t.render(),t.updateLocalStorage()},t.reset=function(){t.form.reset(),t.hidden.value="",t.container.classList.remove("shopList_state_valid")},t.render=function(){var e=document.createElement("ul");e.classList.add("shopListMain__list"),t.shopList.forEach(function(n){var i=document.createElement("li");i.classList.add("shopListMain__item"),i.innerHTML=t.template,i.querySelector(".shopListItem__content").setAttribute("data-id",n.id),i.querySelector(".shopListItem__content").innerHTML=n.title,i.querySelector(".shopListItem__btn_type_complete").setAttribute("data-id",n.id),i.querySelector(".shopListItem__btn_type_edit").setAttribute("data-id",n.id),n.isOpen&&i.querySelector(".shopListItem").classList.add("shopListItem_state_open"),e.appendChild(i)}),t.content.innerHTML="",t.content.appendChild(e)},t.updateLocalStorage=function(){var e=JSON.stringify(t.shopList);localStorage.setItem("shopList",e)},t.init=function(){t.getOptions(),t.setupListener(),t.loadData(),t.render()}},e=new t;window.addEventListener("load",function(){return e.init()}),document.addEventListener("deviceready",function(){return e.init()})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4ubWluLmpzIiwic2hvcExpc3Qvc2hvcExpc3QuanMiXSwibmFtZXMiOlsiU2hvcExpc3QiLCJzZWxmIiwidGhpcyIsImdldE9wdGlvbnMiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwidGVtcGxhdGUiLCJpbm5lckhUTUwiLCJvcGVuRm9vdGVyQnRuIiwiZm9vdGVyIiwiaW5wdXQiLCJoaWRkZW4iLCJmb3JtIiwic3VibWl0QnRuIiwic2hvcExpc3QiLCJsb2FkRGF0YSIsImxvY2FsRGF0YSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJzZXR1cExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJvcGVuRm9vdGVyIiwidGFyZ2V0IiwidmFsdWUiLCJsZW5ndGgiLCJjbG9zZUZvb3RlciIsImhhbmRsZUtleVVwIiwic3VibWl0IiwiaGFuZGxlU3VibWl0QnRuIiwicm91dGVDbGljayIsIm1ldGhvZCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwidG9nZ2xlSXRlbVBhbmVsIiwiaWQiLCJnZXRBdHRyaWJ1dGUiLCJtYXAiLCJzaG9wSXRlbSIsImlzT3BlbiIsInJlbmRlciIsInVwZGF0ZUxvY2FsU3RvcmFnZSIsImNvbXBsZXRlIiwiZmlsdGVyIiwiZWRpdCIsImZpbmQiLCJ0aXRsZSIsImFkZCIsInNldFRpbWVvdXQiLCJpbml0Rm9jdXMiLCJyZW1vdmUiLCJmb2N1cyIsImhpZGRlblZhbHVlIiwic2hvcExpc3RMZW5ndGgiLCJpdGVtIiwicHVzaCIsInJlc2V0IiwiY29udGVudExpc3QiLCJjcmVhdGVFbGVtZW50IiwiZm9yRWFjaCIsImVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsImRhdGEiLCJzdHJpbmdpZnkiLCJzZXRJdGVtIiwiaW5pdCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IkFBQUEsY0NBQSxX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LDBCQUFBNEQsYUFBQSxVQUFBUCxFQUFBbkIsSUFDQXlCLEVBQUEzRCxjQUFBLDBCQUFBRyxVQUFBa0QsRUFBQVIsTUFDQWMsRUFBQTNELGNBQUEsb0NBQUE0RCxhQUFBLFVBQUFQLEVBQUFuQixJQUNBeUIsRUFBQTNELGNBQUEsZ0NBQUE0RCxhQUFBLFVBQUFQLEVBQUFuQixJQUVBbUIsRUFBQWYsUUFFQXFCLEVBQUEzRCxjQUFBLGlCQUFBK0IsVUFBQWUsSUFBQSwyQkFJQVUsRUFBQUssWUFBQUYsS0FHQWhFLEVBQUFNLFFBQUFFLFVBQUEsR0FFQVIsRUFBQU0sUUFBQTRELFlBQUFMLElBTUE3RCxFQUFBNkMsbUJBQUEsV0FDQSxHQUFBc0IsR0FBQS9DLEtBQUFnRCxVQUFBcEUsRUFBQWUsU0FFQUcsY0FBQW1ELFFBQUEsV0FBQUYsSUFNQW5FLEVBQUFzRSxLQUFBLFdBQ0F0RSxFQUFBRSxhQUNBRixFQUFBc0IsZ0JBQ0F0QixFQUFBZ0IsV0FDQWhCLEVBQUE0QyxXQUlBN0IsRUFBQSxHQUFBaEIsRUFFQXdFLFFBQUFoRCxpQkFBQSxPQUFBLFdBQUEsTUFBQVIsR0FBQXVELFNBQ0FsRSxTQUFBbUIsaUJBQUEsY0FBQSxXQUFBLE1BQUFSLEdBQUF1RCIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNob3BMaXN0IGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBTaG9wTGlzdCA9IGZ1bmN0aW9uIFNob3BMaXN0KCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBvcHRpb25zIGZvciBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Jyk7XG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RNYWluX19jb250ZW50Jyk7XG4gICAgICAgICAgICBzZWxmLnRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Nob3BMaXN0SXRlbScpLmlubmVySFRNTDtcbiAgICAgICAgICAgIHNlbGYub3BlbkZvb3RlckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdE1haW5fX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuZm9vdGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyJyk7XG4gICAgICAgICAgICBzZWxmLmlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19pbnB1dCcpO1xuICAgICAgICAgICAgc2VsZi5oaWRkZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2hpZGRlbicpO1xuICAgICAgICAgICAgc2VsZi5mb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19mb3JtJyk7XG4gICAgICAgICAgICBzZWxmLnN1Ym1pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9fYnRuLnNob3BMaXN0Rm9vdGVyX19idG5fdHlwZV9zdWJtaXQnKTtcbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgdGhlcmUgZGF0YSBpbiBsb2NhbCBzdG9yYWdlIGFuZCBsb2FkIGl0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmxvYWREYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGxvY2FsRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzaG9wTGlzdCcpO1xuXG4gICAgICAgICAgICBpZiAobG9jYWxEYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gSlNPTi5wYXJzZShsb2NhbERhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBzZWxmLm9wZW5Gb290ZXIoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VsZi5mb290ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBzZWxmLmZvb3RlciAmJiBzZWxmLmlucHV0LnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2xvc2VGb290ZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlbGYuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBzZWxmLmhhbmRsZUtleVVwKTtcbiAgICAgICAgICAgIHNlbGYuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBzZWxmLnN1Ym1pdCk7XG4gICAgICAgICAgICBzZWxmLnN1Ym1pdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYuaGFuZGxlU3VibWl0QnRuKTtcbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi5yb3V0ZUNsaWNrKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUm91dGVzIGNsaWNrIGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yb3V0ZUNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgdmFyIG1ldGhvZCA9ICcnO1xuXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2hvcExpc3RJdGVtX19jb250ZW50JykpIHtcblxuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICd0b2dnbGVJdGVtUGFuZWwnO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2NvbXBsZXRlJykpIHtcblxuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICdjb21wbGV0ZSc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fYnRuX3R5cGVfZWRpdCcpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAnZWRpdCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtZXRob2QpIHtcblxuICAgICAgICAgICAgICAgIHNlbGZbbWV0aG9kXShldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvZ2dsZSBzaG9wIGl0ZW0gcGFuZWxcbiAgICAgICAgICogQHBhcmFtIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnRvZ2dsZUl0ZW1QYW5lbCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fY29udGVudCcpKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gc2VsZi5zaG9wTGlzdC5tYXAoZnVuY3Rpb24gKHNob3BJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvcEl0ZW0uaWQgPT0gaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3BJdGVtLmlzT3BlbiA9ICFzaG9wSXRlbS5pc09wZW47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaG9wSXRlbTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZSBzaG9wIGl0ZW0gZnJvbSBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5jb21wbGV0ZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIHZhciBpZCA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcblxuICAgICAgICAgICAgaWYgKGlkKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnNob3BMaXN0ID0gc2VsZi5zaG9wTGlzdC5maWx0ZXIoZnVuY3Rpb24gKHNob3BJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzaG9wSXRlbS5pZCAhPSBpZDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRWRpdCBzaG9wIGl0ZW0gY29udGVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZWRpdCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIHZhciBpZCA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlbGYuc2hvcExpc3QuZmluZChmdW5jdGlvbiAoc2hvcEl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW0uaWQgPT0gaWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGlkICYmIHZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmlucHV0LnZhbHVlID0gdmFsdWUudGl0bGU7XG4gICAgICAgICAgICAgICAgc2VsZi5oaWRkZW4udmFsdWUgPSBpZDtcblxuICAgICAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0X3N0YXRlX3ZhbGlkJyk7XG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNob3cgZm9vdGVyIHdpdGggaW5wdXQgZmllbGRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYub3BlbkZvb3RlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0X3N0YXRlX2FkZCcpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmluaXRGb2N1cygpO1xuICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xvc2UgZm9vdGVyIGlmIGNsaWNrIG91dHNpZGUgb2YgZm9vdGVyIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmNsb3NlRm9vdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIGlmIGlucHV0IHZhbHVlIGxlbmd0aCA+IDAgYW5kIGNoYW5nZSBjb250YWluZXIgc3RhdGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlS2V5VXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzZWxmLmlucHV0LnZhbHVlO1xuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSBsZW5ndGggPiAwID8gJ2FkZCcgOiAncmVtb3ZlJztcblxuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0W21ldGhvZF0oJ3Nob3BMaXN0X3N0YXRlX3ZhbGlkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXAgaW5wdXQgZm9jdXNcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmhhbmRsZVN1Ym1pdEJ0biA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgc2VsZi5zdWJtaXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IGZvY3VzIG9uIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRGb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGZvcm0gc3VibWlzc2lvbi4gQWRkIG5ldyBpdGVtIHRvIHNob3AgbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc3VibWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNlbGYuaW5wdXQudmFsdWU7XG4gICAgICAgICAgICB2YXIgaGlkZGVuVmFsdWUgPSBzZWxmLmhpZGRlbi52YWx1ZTtcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmIChsZW5ndGggPT09IDApIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNob3BMaXN0TGVuZ3RoID0gc2VsZi5zaG9wTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgaWQgPSBoaWRkZW5WYWx1ZSA/IGhpZGRlblZhbHVlIDogc2hvcExpc3RMZW5ndGggPT09ICcwJyA/ICcwJyA6ICcnICsgKHNob3BMaXN0TGVuZ3RoICsgMSk7XG4gICAgICAgICAgICB2YXIgaXNPcGVuID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNlbGYuc2hvcExpc3QuZmluZChmdW5jdGlvbiAoc2hvcEl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2hvcEl0ZW0uaWQgPT0gaWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcblxuICAgICAgICAgICAgICAgIGl0ZW0udGl0bGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlRm9vdGVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGlzT3BlbjogaXNPcGVuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbGYucmVzZXQoKTtcbiAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7XG4gICAgICAgICAgICBzZWxmLnVwZGF0ZUxvY2FsU3RvcmFnZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXNldCBmb3JtXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5mb3JtLnJlc2V0KCk7XG4gICAgICAgICAgICBzZWxmLmhpZGRlbi52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvcExpc3Rfc3RhdGVfdmFsaWQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyIHNob3AgbGlzdFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdE1haW5fX2xpc3QnKTtcblxuICAgICAgICAgICAgc2VsZi5zaG9wTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdE1haW5fX2l0ZW0nKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHNlbGYudGVtcGxhdGU7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2NvbnRlbnQnKS5pbm5lckhUTUwgPSBpdGVtLnRpdGxlO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbV9fYnRuX3R5cGVfY29tcGxldGUnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2VkaXQnKS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBpdGVtLmlkKTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzT3Blbikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0SXRlbScpLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0SXRlbV9zdGF0ZV9vcGVuJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudExpc3QpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVcGRhdGUgbG9jYWwgc3RvcmFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHNlbGYuc2hvcExpc3QpO1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2hvcExpc3QnLCBkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0T3B0aW9ucygpO1xuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG4gICAgICAgICAgICBzZWxmLmxvYWREYXRhKCk7XG4gICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgc2hvcExpc3QgPSBuZXcgU2hvcExpc3QoKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2hvcExpc3QuaW5pdCgpO1xuICAgIH0pO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZXJlYWR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2hvcExpc3QuaW5pdCgpO1xuICAgIH0pO1xufSkoKTsiLCIoKCkgPT4ge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgU2hvcExpc3QgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgY29uc3QgU2hvcExpc3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBvcHRpb25zIGZvciBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0T3B0aW9ucyA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Jyk7XG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RNYWluX19jb250ZW50Jyk7XG4gICAgICAgICAgICBzZWxmLnRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Nob3BMaXN0SXRlbScpLmlubmVySFRNTDtcbiAgICAgICAgICAgIHNlbGYub3BlbkZvb3RlckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdE1haW5fX29wZW4nKTtcbiAgICAgICAgICAgIHNlbGYuZm9vdGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyJyk7XG4gICAgICAgICAgICBzZWxmLmlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19pbnB1dCcpO1xuICAgICAgICAgICAgc2VsZi5oaWRkZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RGb290ZXJfX2hpZGRlbicpO1xuICAgICAgICAgICAgc2VsZi5mb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNob3BMaXN0Rm9vdGVyX19mb3JtJyk7XG4gICAgICAgICAgICBzZWxmLnN1Ym1pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEZvb3Rlcl9fYnRuLnNob3BMaXN0Rm9vdGVyX19idG5fdHlwZV9zdWJtaXQnKTtcbiAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgdGhlcmUgZGF0YSBpbiBsb2NhbCBzdG9yYWdlIGFuZCBsb2FkIGl0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmxvYWREYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBsb2NhbERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2hvcExpc3QnKTtcblxuICAgICAgICAgICAgaWYgKGxvY2FsRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdCA9IEpTT04ucGFyc2UobG9jYWxEYXRhKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlbGYuZm9vdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHNlbGYuZm9vdGVyICYmIHNlbGYuaW5wdXQudmFsdWUubGVuZ3RoID09PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbG9zZUZvb3RlcigpO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZWxmLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgc2VsZi5oYW5kbGVLZXlVcCk7XG4gICAgICAgICAgICBzZWxmLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0Jywgc2VsZi5zdWJtaXQpO1xuICAgICAgICAgICAgc2VsZi5zdWJtaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLmhhbmRsZVN1Ym1pdEJ0bik7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYucm91dGVDbGljayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJvdXRlcyBjbGljayBldmVudFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucm91dGVDbGljayA9IGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGxldCBtZXRob2QgPSAnJztcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fY29udGVudCcpKSB7XG5cbiAgICAgICAgICAgICAgICBtZXRob2QgPSAndG9nZ2xlSXRlbVBhbmVsJztcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2NvbXBsZXRlJykpIHtcblxuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICdjb21wbGV0ZSc7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2hvcExpc3RJdGVtX19idG5fdHlwZV9lZGl0JykpIHtcblxuICAgICAgICAgICAgICAgIG1ldGhvZCA9ICdlZGl0JztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWV0aG9kKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmW21ldGhvZF0oZXZlbnQpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvZ2dsZSBzaG9wIGl0ZW0gcGFuZWxcbiAgICAgICAgICogQHBhcmFtIGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnRvZ2dsZUl0ZW1QYW5lbCA9IGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcblxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3BMaXN0SXRlbV9fY29udGVudCcpKSB7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBpZCA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcblxuICAgICAgICAgICAgICAgIGlmIChpZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBzZWxmLnNob3BMaXN0Lm1hcChzaG9wSXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvcEl0ZW0uaWQgPT0gaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3BJdGVtLmlzT3BlbiA9ICFzaG9wSXRlbS5pc09wZW47XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNob3BJdGVtO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZUxvY2FsU3RvcmFnZSgpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZSBzaG9wIGl0ZW0gZnJvbSBsaXN0XG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5jb21wbGV0ZSA9IGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuXG4gICAgICAgICAgICBpZiAoaWQpIHtcblxuICAgICAgICAgICAgICAgIHNlbGYuc2hvcExpc3QgPSBzZWxmLnNob3BMaXN0LmZpbHRlcihzaG9wSXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzaG9wSXRlbS5pZCAhPSBpZDtcbiAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZUxvY2FsU3RvcmFnZSgpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVkaXQgc2hvcCBpdGVtIGNvbnRlbnRcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmVkaXQgPSBldmVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICBjb25zdCBpZCA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2VsZi5zaG9wTGlzdC5maW5kKHNob3BJdGVtID0+IHNob3BJdGVtLmlkID09IGlkKTtcblxuICAgICAgICAgICAgaWYgKGlkICYmIHZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBzZWxmLmlucHV0LnZhbHVlID0gdmFsdWUudGl0bGU7XG4gICAgICAgICAgICAgICAgc2VsZi5oaWRkZW4udmFsdWUgPSBpZDtcblxuICAgICAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3BMaXN0X3N0YXRlX3ZhbGlkJyk7XG4gICAgICAgICAgICAgICAgc2VsZi5vcGVuRm9vdGVyKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBmb290ZXIgd2l0aCBpbnB1dCBmaWVsZFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5vcGVuRm9vdGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgc2VsZi5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3Rfc3RhdGVfYWRkJyk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNlbGYuaW5pdEZvY3VzKCk7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9zZSBmb290ZXIgaWYgY2xpY2sgb3V0c2lkZSBvZiBmb290ZXIgaW5wdXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuY2xvc2VGb290ZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG9wTGlzdF9zdGF0ZV9hZGQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgaW5wdXQgdmFsdWUgbGVuZ3RoID4gMCBhbmQgY2hhbmdlIGNvbnRhaW5lciBzdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5oYW5kbGVLZXlVcCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2VsZi5pbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IG1ldGhvZCA9IGxlbmd0aCA+IDAgPyAnYWRkJyA6ICdyZW1vdmUnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3RbbWV0aG9kXSgnc2hvcExpc3Rfc3RhdGVfdmFsaWQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcCBpbnB1dCBmb2N1c1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaGFuZGxlU3VibWl0QnRuID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgc2VsZi5zdWJtaXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IGZvY3VzIG9uIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRGb2N1cyA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIGZvcm0gc3VibWlzc2lvbi4gQWRkIG5ldyBpdGVtIHRvIHNob3AgbGlzdFxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc3VibWl0ID0gZXZlbnQgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc2VsZi5pbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IGhpZGRlblZhbHVlID0gc2VsZi5oaWRkZW4udmFsdWU7XG4gICAgICAgICAgICBjb25zdCBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmIChsZW5ndGggPT09IDApIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzaG9wTGlzdExlbmd0aCA9IHNlbGYuc2hvcExpc3QubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgaWQgPSBoaWRkZW5WYWx1ZSA/IGhpZGRlblZhbHVlIDogKHNob3BMaXN0TGVuZ3RoID09PSAnMCcpID8gJzAnIDogJycgKyAoc2hvcExpc3RMZW5ndGggKyAxKTtcbiAgICAgICAgICAgIGNvbnN0IGlzT3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHNlbGYuc2hvcExpc3QuZmluZChzaG9wSXRlbSA9PiBzaG9wSXRlbS5pZCA9PSBpZCk7XG5cbiAgICAgICAgICAgIGlmIChpdGVtKSB7XG5cbiAgICAgICAgICAgICAgICBpdGVtLnRpdGxlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgc2VsZi5jbG9zZUZvb3RlcigpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgc2VsZi5zaG9wTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGlzT3BlbjogaXNPcGVuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VsZi5yZXNldCgpO1xuICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTtcbiAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYWxTdG9yYWdlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlc2V0IGZvcm1cbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVzZXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmZvcm0ucmVzZXQoKTtcbiAgICAgICAgICAgIHNlbGYuaGlkZGVuLnZhbHVlID0gJyc7XG4gICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG9wTGlzdF9zdGF0ZV92YWxpZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXIgc2hvcCBsaXN0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3QgY29udGVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuXG4gICAgICAgICAgICBjb250ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdE1haW5fX2xpc3QnKTtcblxuICAgICAgICAgICAgc2VsZi5zaG9wTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc2hvcExpc3RNYWluX19pdGVtJyk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBzZWxmLnRlbXBsYXRlO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtX19jb250ZW50Jykuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgaXRlbS5pZCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtX19jb250ZW50JykuaW5uZXJIVE1MID0gaXRlbS50aXRsZTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW1fX2J0bl90eXBlX2NvbXBsZXRlJykuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgaXRlbS5pZCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2hvcExpc3RJdGVtX19idG5fdHlwZV9lZGl0Jykuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgaXRlbS5pZCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc09wZW4pIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaG9wTGlzdEl0ZW0nKS5jbGFzc0xpc3QuYWRkKCdzaG9wTGlzdEl0ZW1fc3RhdGVfb3BlbicpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29udGVudExpc3QuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZi5jb250ZW50LmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudExpc3QpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVcGRhdGUgbG9jYWwgc3RvcmFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi51cGRhdGVMb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnN0cmluZ2lmeShzZWxmLnNob3BMaXN0KTtcblxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Nob3BMaXN0JywgZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmdldE9wdGlvbnMoKTtcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuICAgICAgICAgICAgc2VsZi5sb2FkRGF0YSgpO1xuICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgY29uc3Qgc2hvcExpc3QgPSBuZXcgU2hvcExpc3QoKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gc2hvcExpc3QuaW5pdCgpKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkZXZpY2VyZWFkeScsICgpID0+IHNob3BMaXN0LmluaXQoKSk7XG59KSgpO1xuIl19
